<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>××¢×¨×›×ª × ×•×›×—×•×ª NFC - ×§×™×¦×•×¨</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            margin: 0;
        }
        .container {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            padding: 2rem;
            text-align: center;
            max-width: 400px;
        }
        .status {
            padding: 20px;
            border-radius: 10px;
            margin: 20px 0;
            font-size: 1.2rem;
            font-weight: bold;
        }
        .success {
            background: rgba(76, 175, 80, 0.3);
            border: 2px solid #4CAF50;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ¯ ××¢×¨×›×ª × ×•×›×—×•×ª NFC</h1>
        <div id="status" class="status success">
            â³ ××¢×‘×“ × ×•×›×—×•×ª...
        </div>
    </div>

    <script>
        // ××§×‘×œ ×¤×¨××˜×¨×™× ××”-URL
        const urlParams = new URLSearchParams(window.location.search);
        const employeeId = urlParams.get('employee_id') || 'emp001';
        
        // ×©××•×ª ×¢×•×‘×“×™×
        const employeeNames = {
            'emp001': '×¢×•×‘×“ ×¨××©×•×Ÿ',
            'emp002': '×¢×•×‘×“ ×©× ×™', 
            'emp003': '×¢×•×‘×“ ×©×œ×™×©×™'
        };
        
        const employeeName = employeeNames[employeeId] || employeeId;
        
        // ×‘×•×“×§ ×¡×˜×˜×•×¡ × ×•×›×—×™
        let attendanceData = JSON.parse(localStorage.getItem('attendanceData')) || [];
        
        // ××•×¦× ××ª ×”×¨×™×©×•× ×”××—×¨×•×Ÿ ×©×œ ×”×¢×•×‘×“
        const lastRecord = attendanceData
            .filter(record => record.employee_id === employeeId)
            .sort((a, b) => new Date(b.timestamp) - new Date(a.timestamp))[0];
        
        const currentStatus = lastRecord?.action === 'checkin' ? 'in' : 'out';
        const newAction = currentStatus === 'in' ? 'checkout' : 'checkin';
        
        // ×™×•×¦×¨ ×¨×™×©×•× ×—×“×©
        const now = new Date();
        const newRecord = {
            employee_id: employeeId,
            employee_name: employeeName,
            action: newAction,
            timestamp: now.toISOString(),
            date: now.toLocaleDateString('he-IL'),
            time: now.toLocaleTimeString('he-IL')
        };
        
        // ×©×•××¨ ×œ×–×™×›×¨×•×Ÿ ××§×•××™
        attendanceData.push(newRecord);
        localStorage.setItem('attendanceData', JSON.stringify(attendanceData));
        
        // ××¦×™×’ ×”×•×“×¢×”
        const statusDiv = document.getElementById('status');
        const actionText = newAction === 'checkin' ? '×›× ×™×¡×”' : '×™×¦×™××”';
        
        statusDiv.innerHTML = `
            âœ… ${actionText} × ×¨×©××” ×‘×”×¦×œ×—×”!<br>
            ğŸ‘¤ ${employeeName}<br>
            â° ${newRecord.time}
        `;
        
        console.log('×¨×™×©×•× × ×•×›×—×•×ª:', newRecord);
        
        // ×—×–×¨×” ××•×˜×•××˜×™×ª ×œ×“×£ ×”×¨××©×™ ××—×¨×™ 3 ×©× ×™×•×ª
        setTimeout(() => {
            window.location.href = 'nfc-attendance.html';
        }, 3000);
    </script>
</body>
</html>